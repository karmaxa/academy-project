{% extends 'app_main/index.html' %}

{% block content %}
<div style="height:40px"></div>
<div class="container" style="margin: top 2em;">
    <div class="container">
        class: {{classroom}}<br>
        teacher: {{classroom.teacher}}<br>
        students: {{students}}<br>
        lessons: {{classroom.lessons}}<br>
        today: {{today}}<br>
    </div>
    <div class="container">
        <form action="editlesson/" method="POST">
        <table class="table table-sm table-bordered" style="width: fit-content; text-align: left;">
            <thead>
                <tr style="vertical-align: middle;">
                    <th scope="col">Students</th>
                    {% for lesson in lessons %}
                    <th scope="col" rowspan="2">
                                <input type="date" class="form-control form-control-sm date" name="{{lesson.title}}_date" value="{{lesson.dateform}}">
                                <input type="text" class="form-control form-control-sm" name="{{lesson.title}}_title" value="{{lesson.title}}">
                                <button type="submit" class="btn btn-outline-danger btn-sm" name="deletelesson" value="{{lesson.id}}">Delete lesson</button>
                                
                    </th>
                    {% endfor %}
                    {% csrf_token %}
                    <th scope="col">
                        <input type="date" class="form-control form-control-sm date" name="newlesson_date" value="{{today}}">
                        <input type="text" class="form-control form-control-sm" name="newlesson_title" value="{{newles_title}}">
                        <button type="submit" class="btn btn-outline-primary btn-sm" name="newlesson" value="True">Commit lesson</button>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>
                        {{student.name}}
                    </td>
                    {% for lesson in classroom.lessons %}
                    <input type="hidden" id="{{student.name}}" value="{{student}}">
                    <td>
                        <select class="form-control form-control-sm select" name="{{student.identifier}}_lesson{{lesson.id}}">
                            <option selected id="{{student.identifier}}_lesson{{lesson.id}}"></option>
                            <option></option>
                            {% for mark in marks %}
                            <option>
                                {{mark}}
                            </option>
                            {% endfor %}
                        </select>
                    </td>
                    <script>
                        stname = "{{student.name}}";
                        stid = "{{student.identifier}}";
                        stud = document.getElementById(stname).value;
                        stud = stud.replace(/'/g, '"');
                        lesid = "{{lesson.id}}";
                        st = JSON.parse(stud);
                        mark = st[lesid];
                        if (mark === "null"){
                            mark = null;
                        }
                        idd = String(stid + "_lesson" + lesid)
                        el = document.getElementById(idd);
                        el.innerHTML = mark;
                    </script>
                    {% endfor %}
                    <td colspan="2">
                        <select class="form-control form-control-sm" name="{{student.identifier}}_newlesson">
                            <option selected></option>
                            {% for mark in marks %}
                            <option>
                                {{mark}}
                            </option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                {% endfor %}
            
            </tbody>
        </table>
        <div class="container">
            <button type="submit" class="btn btn-outline-primary btn-sm" name="commitchanges" value="True">Commit changes</button>
        </div>
    </form>
    </div>
    <div class="mb-3">
        <a href="../">back
        </a>
    </div>
</div>

{% endblock content %}
